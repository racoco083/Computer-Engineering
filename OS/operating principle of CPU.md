## CPU의 작동 원리

### 중앙 처리 장치(CPU)

중앙처리장치는 다음과 같이 연산장치, 제어장치, 레지스터 3가지로 나누어 설명하는 경우가 많습니다.

* 연산 장치 : 덧셈, 뺄셈, 곱셈, 나눗셈 등의 산술연산과 논리곱, 논리합, 부정 등의 논리연산을 수행합니다. 
두 가지 연산 모두 사용하기 때문에 산술논리연산장치라고도 말합니다. 연산장치는 연산에 필요한 데이터를 
레지스터에서 가져오고, 연산결과를 다시 레지스터로 보내 저장합니다.

* 제어 장치 : 명령어를 순서대로 실행할 수 있도록 제어하는 장치입니다. 주기억장치에서 프로그램 명령어
꺼내 해독한 다음, 해독한 결과에 따라 명령어 실행에 필요한 제어 신호를 기억장치, 연산장치, 입출력장치로 보냅니다.
또한 이들 장치가 보낸 신호를 받아 다음에 수행할 동작을 결정합니다.

* 레지스터 : 중앙처리장치의 속도와 비슷한 고속의 기억장치입니다. 명령어 주소, 명령어 코드, 연산에 필요한
데이터, 연산 결과등을 임시로 저장합니다. 용도에 따라 범용 레지스터와 특수 목적 레지스터로 구분됩니다.
중앙처리장치의 종류에 따라 사용할 수 있는 레지스터의 개수와 크기가 다른 것도 기억해두면 좋습니다.
범용 레지스터란 연산에 필요한 데이터나 연산 결과를 임시로 저장하는 레지스터입니다. 반면에 특수 목적
레지스터란 특별한 용도로 사용하는 레지스터로, 용도와 기능에 따라 구분되는 레지스터입니다.

특수 목적 레지스터 중에서 기억해놓으면 좋은 것들이 아래의 레지스터들입니다.

1. 메모리 주소 레지스터(MAR) : 읽기와 쓰기 연산을 수행할 주기억장치의 주소를 저장합니다.
2. 프로그램 카운터(PC) : 다음에 수행할 명령어의 주소를 저장합니다.
3. 명령어 레지스터(IR) : 현재 실행 중인 명령어를 저장합니다.
4. 메모리 버퍼 레지스터(MBR) : 주기억장치에서 읽어온 데이터나 주기억장치에 저장할 데이터를 임시로 저장합니다.
(명령어 코드, 변수 데이터 등이 여기서 말하는 데이터이다.)
5. 누산기(AC) : 연산 결과를 임시로 저장합니다.

### 중앙처리장치의 동작 과정

1. 주기억장치는 입력장치에서 입력받은 데이터 또는 보조기억장치에 저장된 프로그램을 읽어옵니다.
2. 중앙처리장치는 프로그램을 실행하기 위해 주기억장치에 저장된 프로그램 명령어과 데이터를 읽어와
처리하고 결과를 다시 주기억 장치에 저장합니다.
3. 주기억장치는 처리 결과를 보조기억장치에 저장하거나 출력장치로 내보냅니다.
4. 제어장치는 1~3 과정에서 명령어가 순서대로 실행될 수 있도록 각 장치를 제어합니다.

명령어 세트란 중앙처리장치가 실행할 명령어의 집합으로서 중앙처리장치에 따라 형식과 종류가 다릅니다.
명령어는 실행할 연산을 나타내는 연산 코드(Operation Code)와 연산에 필요한 데이터나 데이터의 저장 위치를
나타내는 피연산자(Operand)로 구성됩니다.

![image](https://user-images.githubusercontent.com/21019088/56424164-0fe44c00-62ea-11e9-8e73-449504414205.png)

연산 코드는 실행하는 연산의 종류에 따라 다음과 같이 네 가지 기능으로 나뉩니다.

- 연산 기능 : 사칙연산, 시프트, 보수 등의 산술연산과 논리곱, 논리합, 부정 등의 논리연산을 수행합니다.
- 제어 기능 : 조건 분기와 무조건 분기 등을 사용하여 명령어의 실행 순서를 제어합니다.
- 데이터 전달 기능 : 레지스터와 레지스터 사이, 레지스터와 주기억장치 사이에서 데이터를 전달합니다.
- 입출력 기능 : 프로그램과 데이터를 주기억장치에 전달하고, 연산 결과는 출력장치로 전달합니다.

연산 코드는 길이가 n비트일 때 최대 2^n개의 연산을 정의할 수 있습니다.

피연산자는 주소, 숫자, 문자, 논리, 데이터 등을 저장할 수 있습니다.

- 주소 : 기억장치 혹은 레지스터의 주소가 저장됩니다.
- 숫자/문자 : 숫자는 정수, 고정 소수점 수, 부동 소수점 수 및 각각의 코드로 저장되고 문자는
아스키 코드로 저장됩니다.
- 논리 데이터 : 참 또는 거직을 표현할 때 사용하여 비트나 플래그 등으로 저장됩니다.

중앙처리장치는 프로그램을 실행하기 위해 주기억장치에서 명령어를 순차적으로 인출하여 해독하고 
실행하는 과정을 반복합니다. 중앙처리장치에서 한 번에 하나의 명령어를 인출하여 실행하는 데 필요한
일련의 활동을 명령어 사이클(Instruction Cycle)이라 하고, 명령어 사이클은 인출 사이클과
실행 사이클로 나뉩니다. 주기억장치의 지정된 주소에서 하나의 명령어를 가져오고, 실행 사이클에서는
명령어를 실행합니다. 하나의 명령어 실행이 완료되면 그 다음 명령어에 대한 인출 사이클이 시작됩니다.

![image](https://user-images.githubusercontent.com/21019088/56424527-964d5d80-62eb-11e9-818d-cebb78f7f584.png)

명령어 사이클을 세분화하면 구체적으로 인출 사이클, 실행 사이클, 간접 사이클, 인터럽트 사이클로 나눌 수 있습니다.
이때 인출 사이클과 실행 사이클은 항상 수행되지만 간접 사이클과 인터럽트 사이클은 주소 지정 방식이 필요할 때나
인터럽트 요구가 있을 때만 수행됩니다.

구체적으로 인출 사이클과 실행 사이클에 의한 명령어 처리 과정을 이해하기 위해서는 조금 더 복잡한 지식이 수반됩니다.
인출 사이클에서 가장 중요한 부분은 바로 프로그램 카운터(PC) 값의 증가입니다. 프로그램 카운터는 다음에 수행할 명령어의
주소를 포함하고 있습니다. 다음 묘사는 인출 사이클에 사용되는 특수 목적 레지스터의 종류와 인출 사이클의 동작 과정을 보여줍니다.

![image](https://user-images.githubusercontent.com/21019088/56424698-605ca900-62ec-11e9-8342-de3771e25785.png)

위에서 보시면 먼저 PC에 저장된 주소를 MAR로 전달하는 것을 볼 수 있습니다. 그 이후에 MAR에 저장 된 내용을 토대로 주기억장치의
해당 주소에서 명령어를 인출합니다. 그 뒤에는 인출한 명령어를 MBR에 저장합니다. 여기서 중요한 포인트가 다음 명령어를 인출하기 위해
프로그램 카운터(PC)의 값을 증가시킨다는 것입니다. 마지막으로 메모리 버퍼 레지스터(MBR)에 저장된 내용을 명령어 레지스터(IR)에
전달합니다.

![image](https://user-images.githubusercontent.com/21019088/56424885-fc86b000-62ec-11e9-87d4-76e2e9569fa0.png)

밑의 그림은 가장 만만한 ADD 연산 처리 실행 사이클입니다.

![image](https://user-images.githubusercontent.com/21019088/56424963-4079b500-62ed-11e9-8412-94b915e83aef.png)

![image](https://user-images.githubusercontent.com/21019088/56424975-512a2b00-62ed-11e9-97e5-29b57e4b5b99.png)

위처럼 정리할 수 있습니다. 

## Reference
https://blog.naver.com/ndb796/220687216382 (CPU 동작 과정 핵심만 잘 설명하였다.)
